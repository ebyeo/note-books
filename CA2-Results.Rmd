---
title: "CA2 - Investmnt Portfolio Fuzzy Expert System"
output: html_notebook
---

This Notebook describes the fuzzy expert system and the output of the test cases for each rule block. 

#Initialise
Prepare the environment and load the necessary libraries.
```{r}
rm(list=ls())

library(sets)
```
Set the universe
```{r}
sets_options("universe", seq(from = 0, to = 100, by = 1))
```
#Define Variables
Set the variables and liguistic terms for the input and output variables
```{r}
variables = set(
  age_input = fuzzy_variable(
    a_young = fuzzy_trapezoid(corners = c(-20, 0, 35, 45)),
    a_middle = fuzzy_trapezoid(corners = c(35, 45, 55, 65)),
    a_old = fuzzy_trapezoid(corners = c(55, 65, 100, 120))
  ),
  
  income_input = fuzzy_variable(
    i_low = fuzzy_trapezoid(corners = c(-20, 0, 40, 50)),
    i_medium = fuzzy_trapezoid(corners = c(40, 45, 75, 80)),
    i_high = fuzzy_trapezoid(corners = c(75, 80, 100, 120))
  ),
  
  risk_input = fuzzy_variable(
    r_low = fuzzy_trapezoid(corners = c(-20, 0, 20, 30)),
    r_medium = fuzzy_trapezoid(corners = c(20, 30, 40, 50)),
    r_high = fuzzy_trapezoid(corners = c(40, 50, 100,120))
  ),
  
  current_property_input = fuzzy_variable(
    cp_low = fuzzy_trapezoid(corners = c(-20, 0, 90, 95)),
    cp_medium = fuzzy_trapezoid(corners = c(85, 90, 95, 100)),
    cp_high = fuzzy_trapezoid(corners = c(90, 95, 100, 120))
  ),
  
  current_stock_input = fuzzy_variable(
    cs_low = fuzzy_trapezoid(corners = c(-20, 0, 5, 7)),
    cs_medium = fuzzy_trapezoid(corners = c(4, 5, 10, 12)),
    cs_high = fuzzy_trapezoid(corners = c(8, 10, 100, 120))
  ),
  
  current_bank_input = fuzzy_variable(
    cb_low = fuzzy_trapezoid(corners = c(-20, 0, 5, 7)),
    cb_medium = fuzzy_trapezoid(corners = c(4, 5, 10, 12)),
    cb_high = fuzzy_trapezoid(corners = c(8, 10, 100, 120))
  ),
  
  property_output = fuzzy_variable(
    op_low = fuzzy_trapezoid(corners = c(-20,0, 30, 50)),
    op_medium = fuzzy_trapezoid(corners = c(30, 50, 70, 90)),
    op_high = fuzzy_trapezoid(corners = c(60, 70, 100, 120))
  ),
  
  stock_output = fuzzy_variable(
    os_low = fuzzy_trapezoid(corners = c(-20, 0, 5, 7)),
    os_medium = fuzzy_trapezoid(corners = c(4, 5, 10, 12)),
    os_high = fuzzy_trapezoid(corners = c(8, 10, 100, 120))
  ),
  
  bank_output = fuzzy_variable(
    ob_low = fuzzy_trapezoid(corners = c(-20, 0, 5, 7)),
    ob_medium = fuzzy_trapezoid(corners = c(4, 5, 10, 12)),
    ob_high = fuzzy_trapezoid(corners = c(8, 10, 100, 120))
  )
)
```
#Define Property Rules
```{r}
property_rules <-
  set(
    fuzzy_rule(age_input %is% a_young && income_input %is% i_low, property_output %is% op_low),
    fuzzy_rule(age_input %is% a_young && income_input %is% i_medium, property_output %is% op_medium),
    fuzzy_rule(age_input %is% a_young && income_input %is% i_high, property_output %is% op_high),
    fuzzy_rule(age_input %is% a_middle && (income_input %is% i_low || income_input %is% i_medium), property_output %is% op_low),
    fuzzy_rule(age_input %is% a_middle && income_input %is% i_high, property_output %is% op_medium),
    fuzzy_rule(age_input %is% a_old, property_output %is% op_low)
  )
```
#Construct the Property Fuzzy System
```{r}
property_system <- fuzzy_system(variables, property_rules)
print(property_system)
plot(property_system)
```
#Define Stock Rules
```{r}
stock_rules <-
  set(
    fuzzy_rule(age_input %is% a_young && income_input %is% i_low && (risk_input %is% r_low || risk_input %is% r_medium), stock_output %is% os_low), #1
    fuzzy_rule(age_input %is% a_young && income_input %is% i_low && risk_input %is% r_high, stock_output %is% os_medium), #2
    fuzzy_rule(age_input %is% a_young && (income_input %is% i_medium || income_input %is% i_high) && risk_input %is% r_low, stock_output %is% os_low), #3
    fuzzy_rule(age_input %is% a_young && (income_input %is% i_medium || income_input %is% i_high) && risk_input %is% r_medium, stock_output %is% os_medium), #4
    fuzzy_rule(age_input %is% a_young && (income_input %is% i_medium || income_input %is% i_high) && risk_input %is% r_high, stock_output %is% os_high), #5
    fuzzy_rule(age_input %is% a_middle && income_input %is% i_low, stock_output %is% os_low), #6
    fuzzy_rule(age_input %is% a_middle && income_input %is% i_medium && (risk_input %is% r_low || risk_input %is% r_medium), stock_output %is% os_low), #7
    fuzzy_rule(age_input %is% a_middle && income_input %is% i_medium && risk_input %is% r_high, stock_output %is% os_medium), #8
    fuzzy_rule(age_input %is% a_middle && income_input %is% i_high && risk_input %is% r_low, stock_output %is% os_low), #9
    fuzzy_rule(age_input %is% a_middle && income_input %is% i_high && risk_input %is% r_medium, stock_output %is% os_medium), #10
    fuzzy_rule(age_input %is% a_middle && income_input %is% i_high && risk_input %is% r_high, stock_output %is% os_high), #11
    fuzzy_rule(age_input %is% a_old && (income_input %is% i_low || income_input %is% i_medium), stock_output %is% os_low), #12
    fuzzy_rule(age_input %is% a_old && income_input %is% i_high && (risk_input %is% r_low || risk_input %is% r_medium), stock_output %is% os_low), #13
    fuzzy_rule(age_input %is% a_old && income_input %is% i_high && risk_input %is% r_high, stock_output %is% os_medium) #14
  )
```
#Construct the Stock Fuzzy System
```{r}
stock_system <- fuzzy_system(variables, stock_rules)
print(stock_system)
plot(stock_system) 
```
# Test Cases for Property
Test Stock Rule #1 - age young, income low then investment in property low
```{r}
fi <- fuzzy_inference(property_system, list(age_input = 25, income_input = 30))
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #2 - age young, income medium then investment in property medium
```{r}
fi <- fuzzy_inference(property_system, list(age_input = 25, income_input = 50))
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #3 - age young, income high then investment in property high
```{r}
fi <- fuzzy_inference(property_system, list(age_input = 25, income_input = 80))
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #4 - age middle, income low then investment in property low
```{r}
fi <- fuzzy_inference(property_system, list(age_input = 47, income_input = 30))
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #5 - age middle, income medium then investment in property low
```{r}
fi <- fuzzy_inference(property_system, list(age_input = 47, income_input = 50))
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #6 - age middle, income high then investment in property medium
```{r}
fi <- fuzzy_inference(property_system, list(age_input = 47, income_input = 80))
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #7 - age old, income high then investment in property low
```{r}
fi <- fuzzy_inference(property_system, list(age_input = 70, income_input = 80))
plot(fi)
gset_defuzzify(fi,"centroid")
```
# Test Cases for Stock
Test Stock Rule #1 - age young, income low, risk appetite low then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 25, income_input = 30, risk_input = 10), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #2 - age young, income low, risk appetite medium then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 25, income_input = 30, risk_input = 35), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #3 - age young, income low, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 25, income_input = 30, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #4 - age young, income medium, risk appetite low then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 25, income_input = 50, risk_input = 10), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #5 - age young, income medium, risk appetite medium then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 25, income_input = 50, risk_input = 35), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #6 - age young, income medium, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 25, income_input = 50, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #7 - age young, income high, risk appetite low then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 25, income_input = 80, risk_input = 10), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #8 - age young, income high, risk appetite medium then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 25, income_input = 80, risk_input = 35), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #9 - age young, income high, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 25, income_input = 80, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #10 - age middle, income low, risk appetite low then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 50, income_input = 30, risk_input = 10), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #11 - age middle, income low, risk appetite medium then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 50, income_input = 30, risk_input = 35), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #12 - age middle, income low, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 50, income_input = 30, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #13 - age middle, income medium, risk appetite low then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 50, income_input = 50, risk_input = 10), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #14 - age middle, income medium, risk appetite medium then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 50, income_input = 50, risk_input = 35), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #15 - age middle, income medium, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 50, income_input = 50, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #16 - age middle, income high, risk appetite low then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 50, income_input = 80, risk_input = 10), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #17 - age middle, income high, risk appetite medium then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 50, income_input = 80, risk_input = 35), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #18 - age middle, income high, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 50, income_input = 80, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #19 - age old, income low, risk appetite low then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 70, income_input = 30, risk_input = 10), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #20 - age old, income low, risk appetite medium then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 70, income_input = 30, risk_input = 35), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #21 - age old, income low, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 70, income_input = 30, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #22 - age old, income medium, risk appetite low then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 70, income_input = 50, risk_input = 10), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #23 - age old, income medium, risk appetite medium then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 70, income_input = 50, risk_input = 35), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #24 - age old, income medium, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 70, income_input = 50, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #25 - age old, income high, risk appetite low then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 70, income_input = 80, risk_input = 10), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #26 - age old, income high, risk appetite medium then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 70, income_input = 80, risk_input = 35), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #27 - age old, income high, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 70, income_input = 80, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
#Boundary cases - between young and middle
Test Stock Rule #28 - age young, income low, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 40, income_input = 30, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #29 - age between young and middle, income low, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 43, income_input = 30, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #30 - age middle, income high, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 45, income_input = 30, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
#Boundary cases - between low and medium income
Test Stock Rule #31 - age young, income low, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 25, income_input = 38, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #32 - age young, income between low and medium, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 25, income_input = 40, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #33 - age young, income between low and medium, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 25, income_input = 42, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #34 - age young, income medium, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 25, income_input = 44, risk_input = 60), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
#Boundary cases - between medium and high risk appetite
Test Stock Rule #35 - age old, income high, risk appetite medium then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 70, income_input = 80, risk_input = 40), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #36 - age old, income high, risk appetite between medium and high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 70, income_input = 80, risk_input = 45), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #37 - age old, income high, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 70, income_input = 80, risk_input = 50), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```
Test Stock Rule #38 - age old, income high, risk appetite high then investment in stock low
```{r}
fi <- fuzzy_inference(stock_system, list(age_input = 70, income_input = 80, risk_input = 55), implication = "minimum")
plot(fi)
gset_defuzzify(fi,"centroid")
```